<?xml version="1.0" encoding="UTF-8"?>

<!-- ==== #29. mapper 기본설정 ==== -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- ==== #29. 루트 엘리먼트 & 네임스페이스 설정(프로젝트 전체내에서 유일해야 한다.) ==== -->
<!-- ==== 대부분은 namespace에 파일이름 사용(유일하니까) ==== -->
<mapper namespace="byungyoon">
	
	<!-- 주소록 메인페이지에서 주소록검색 ajax 쓰기 -->
	<select id="mby_test" parameterType="int" resultType="String">
		select name from mby_test where no = #{no}
	</select>
	
	<select id="mby_rank" parameterType="int" resultType="String">
		select rank from mby_test where no = #{no}
	</select>


	<!-- 주소록 메인페이지에 select 해오기 -->
	<select id="addBook_main_select"  resultType="com.spring.bts.byungyoon.model.AddBookVO">
		select A.pk_addbook_no , A.addb_name , R.ko_rankname, A.phone AS phone, A.email AS email, A.companyname, A.com_tel
		from tbl_ADDBOOK A 
		join tbl_rank_sort R
		on R.PK_RANK_NO = A.fk_rank_no
	</select>
	
	
	<!-- 주소록 연락처에 insert 하기 -->
	<insert id="addBook_telAdd_insert" parameterType="com.spring.bts.byungyoon.model.AddBookVO" >
		insert into tbl_ADDBOOK(PK_ADDBOOK_NO, FK_DEPT_NO, FK_RANK_NO, ADDB_NAME, COM_TEL, POSTCODE, ADDRESS, DETAILADDRESS, REFERENCEADDRESS, PHONE, EMAIL, PHOTOFILEPATH, PHOTOFILENAME, COMPANYNAME, MEMO, COMPANY_ADDRESS, KO_RANKNAME, KO_DEPNAME, FK_EMP_NO  )
		values( addbook_seq.nextval , #{fk_dept_no} ,#{fk_rank_no} , #{addb_name} ,#{com_tel} ,default ,default ,default ,default ,#{phone} ,#{email} ,default ,default ,#{companyname} ,#{memo} ,#{company_address} ,default ,default, default  ) 
	</insert>
	
	
	<!-- 상세부서정보 페이지 사원목록 불러오기 -->
	<select id="addBook_depInfo_select" resultType="com.spring.bts.hwanmo.model.EmployeeVO">
		select E.pk_emp_no, E.emp_name , R.ko_rankname , D.ko_depname , R.pk_rank_no
		from tbl_EMPLOYEES E
		join tbl_rank_sort R
		on E.fk_rank_id = R.pk_rank_no
		join tbl_dep_sort D
		on E.fk_department_id = D.pk_dep_no
		order by R.pk_rank_no
	</select>
	
	
	<!-- 상세부서정보 페이지에서 사원상세정보 ajax로 select 해오기 -->
	<select id="addBook_depInfo_select_ajax" parameterType="int" resultType="com.spring.bts.hwanmo.model.EmployeeVO">
		select E.emp_name , (D.ko_depname) AS ko_depname , (R.ko_rankname) AS ko_rankname , E.uq_email , E.uq_phone , E.address , E.detailaddress , e.extraaddress
		from tbl_employees E
		join tbl_rank_sort R
		on E.fk_rank_id = r.pk_rank_no
		join tbl_dep_sort D
		on E.fk_department_id = d.pk_dep_no
		where pk_emp_no = #{pk_emp_no}
	</select>
	
	<!-- 주소록 메인에서 select 해와서 연락처 update 하기 -->
	<select id="addBook_main_telUpdate" parameterType="int" resultType="com.spring.bts.byungyoon.model.AddBookVO">
		select A.ADDB_NAME , (D.ko_depname) AS ko_depname , (R.ko_rankname) AS ko_rankname , A.EMAIL , A.PHONE , A.COMPANYNAME , A.COM_TEL , A.COMPANY_ADDRESS , A.MEMO
		from tbl_addbook A
		join tbl_rank_sort R
		on A.fk_rank_no = R.pk_rank_no
		join tbl_dep_sort D
		on A.fk_dept_no = D.pk_dep_no
        WHERE pk_addbook_no = #{pk_addbook_no}
	</select>

	
	

</mapper>